@using RestaurangMVCLab2.DTOs
@model UpdateTableDto
@{
    ViewData["Title"] = "Redigera bord - Admin";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var currentTable = ViewBag.CurrentTable as TableResponseDto;
    var tableId = ViewBag.TableId as int?;
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <!-- Header -->
            <div class="text-center mb-4">
                <h2 class="mb-2">
                    <i class="fas fa-edit text-primary me-2"></i>
                    Redigera bord @(currentTable?.TableNumber)
                </h2>
                <p class="text-muted">Uppdatera bordsinformation</p>
            </div>

            <!-- Error Messages -->
            @if (TempData["ErrorMessage"] != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    @TempData["ErrorMessage"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            <!-- Current Table Info -->
            @if (currentTable != null)
            {
                <div class="card mb-4 bg-light">
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <i class="fas fa-chair fa-2x text-primary mb-2"></i>
                                <h6 class="text-muted">Nuvarande</h6>
                                <p class="mb-0"><strong>Bord @currentTable.TableNumber</strong></p>
                            </div>
                            <div class="col-md-3">
                                <i class="fas fa-users fa-2x text-info mb-2"></i>
                                <h6 class="text-muted">Kapacitet</h6>
                                <p class="mb-0"><strong>@currentTable.Capacity platser</strong></p>
                            </div>
                            <div class="col-md-3">
                                <i class="fas fa-@(currentTable.IsActive ? "check-circle" : "pause-circle") fa-2x text-@(currentTable.IsActive ? "success" : "warning") mb-2"></i>
                                <h6 class="text-muted">Status</h6>
                                <p class="mb-0">
                                    <span class="badge bg-@(currentTable.IsActive ? "success" : "secondary")">
                                        @(currentTable.IsActive ? "Aktivt" : "Inaktivt")
                                    </span>
                                </p>
                            </div>
                            <div class="col-md-3">
                                <i class="fas fa-calendar-check fa-2x text-warning mb-2"></i>
                                <h6 class="text-muted">Bokningar</h6>
                                <p class="mb-0"><strong>@currentTable.CurrentBookingsCount st</strong></p>
                            </div>
                        </div>
                    </div>
                </div>
            }

            <!-- Edit Form -->
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-edit me-2"></i>
                        Uppdatera bordsinformation
                    </h5>
                </div>
                <div class="card-body">
                    <form asp-action="Edit" asp-route-id="@tableId" method="post">
                        @Html.AntiForgeryToken()

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="TableNumber" class="form-label">
                                    <i class="fas fa-hashtag text-primary me-1"></i>
                                    @Html.DisplayNameFor(m => m.TableNumber)
                                </label>
                                <input asp-for="TableNumber"
                                       class="form-control @(ViewData.ModelState["TableNumber"]?.Errors.Count > 0 ? "is-invalid" : "")"
                                       placeholder="Lämna tomt för att behålla nuvarande"
                                       min="1" max="999"
                                       type="number" />
                                <span asp-validation-for="TableNumber" class="invalid-feedback"></span>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Nuvarande: @(currentTable?.TableNumber) | Lämna tomt för att behålla
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="Capacity" class="form-label">
                                    <i class="fas fa-users text-primary me-1"></i>
                                    @Html.DisplayNameFor(m => m.Capacity)
                                </label>
                                <input asp-for="Capacity"
                                       class="form-control @(ViewData.ModelState["Capacity"]?.Errors.Count > 0 ? "is-invalid" : "")"
                                       placeholder="Lämna tomt för att behålla nuvarande"
                                       min="1" max="20"
                                       type="number" />
                                <span asp-validation-for="Capacity" class="invalid-feedback"></span>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Nuvarande: @(currentTable?.Capacity) platser | Lämna tomt för att behålla
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="IsActive" class="form-label">
                                <i class="fas fa-toggle-on text-primary me-1"></i>
                                @Html.DisplayNameFor(m => m.IsActive)
                            </label>
                            <select asp-for="IsActive" class="form-select">
                                <option value="">Behåll nuvarande status (@(currentTable?.IsActive == true ? "Aktivt" : "Inaktivt"))</option>
                                <option value="true">Aktivt</option>
                                <option value="false">Inaktivt</option>
                            </select>
                            <div class="form-text">
                                <i class="fas fa-info-circle me-1"></i>
                                Inaktiva bord visas inte vid bokning
                            </div>
                        </div>

                        <!-- Warning for bookings -->
                        @if (currentTable?.CurrentBookingsCount > 0)
                        {
                            <div class="alert alert-warning">
                                <div class="d-flex">
                                    <div class="flex-shrink-0">
                                        <i class="fas fa-exclamation-triangle fa-lg"></i>
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h6 class="mb-1">Obs! Detta bord har aktiva bokningar</h6>
                                        <p class="mb-0">
                                            Bordet har <strong>@currentTable.CurrentBookingsCount</strong> aktiva bokningar.
                                            Var försiktig med ändringar som kan påverka befintliga bokningar.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        }

                        <!-- Information Box -->
                        <div class="alert alert-info">
                            <div class="d-flex">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-lightbulb fa-lg"></i>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h6 class="mb-1">Tips för redigering:</h6>
                                    <ul class="mb-0 small">
                                        <li>Lämna fält tomma för att behålla nuvarande värden</li>
                                        <li>Bordsnummer måste vara unikt</li>
                                        <li>Kapacitetsändringar påverkar framtida bokningar</li>
                                        <li>Inaktiverade bord är inte bokningsbara</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between mt-4">
                            <a href="@Url.Action("Index", "Table", new { area = "Admin" })"
                               class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>
                                Avbryt
                            </a>

                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save me-2"></i>
                                Spara ändringar
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-bolt me-2"></i>
                        Snabbåtgärder
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-flex gap-2 flex-wrap">
                        <!-- Toggle Active -->
                        <form asp-controller="Table" asp-action="ToggleActive" asp-route-id="@tableId"
                              method="post" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit"
                                    class="btn btn-outline-@(currentTable?.IsActive == true ? "warning" : "success") btn-sm"
                                    onclick="return confirm('@(currentTable?.IsActive == true ? "Inaktivera" : "Aktivera") bord @currentTable?.TableNumber?')">
                                <i class="fas fa-@(currentTable?.IsActive == true ? "pause" : "play") me-1"></i>
                                @(currentTable?.IsActive == true ? "Inaktivera bord" : "Aktivera bord")
                            </button>
                        </form>

                        <!-- Delete (if no bookings) -->
                        @if (currentTable?.CurrentBookingsCount == 0)
                        {
                            <form asp-controller="Table" asp-action="Delete" asp-route-id="@tableId"
                                  method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <button type="submit"
                                        class="btn btn-outline-danger btn-sm"
                                        onclick="return confirm('Är du säker på att du vill ta bort bord @currentTable?.TableNumber? Detta går inte att ångra.')">
                                    <i class="fas fa-trash me-1"></i>
                                    Ta bort bord
                                </button>
                            </form>
                        }
                        else
                        {
                            <button type="button" class="btn btn-outline-danger btn-sm" disabled
                                    title="Kan inte ta bort bord med aktiva bokningar">
                                <i class="fas fa-trash me-1"></i>
                                Ta bort bord (har bokningar)
                            </button>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
